<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Five Forks Fire Map — INLINE (with data)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { height:100%; margin:0; padding:0; font-family: system-ui, Arial, sans-serif; }
    #toolbar { position:absolute; top:10px; left:10px; right:10px; z-index:1000; background:rgba(255,255,255,.95); padding:8px 12px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.12); display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    #map { width:100%; height:100%; }
    label { font-size:14px; }
    input[type=range] { width:140px; }
    button { padding:6px 10px; border-radius:8px; border:1px solid #ddd; background:#f7f7f7; cursor:pointer; }
  </style>
</head>
<body>
  <div id="toolbar">
    <strong>Leaflet • Inline fixed (data embedded)</strong>
    <label>Radius <input id="radius" type="range" min="5" max="60" value="20"></label>
    <label>Opacity <input id="opacity" type="range" min="0.1" max="1" value="0.7" step="0.05"></label>
    <button id="toggleLayer">Toggle Heatmap / Pins</button>
    <button id="toggleBasemap">Basemap: On</button>
  </div>
  <div id="map"></div>

  <!-- Embedded, pre-repaired FeatureCollection (points-only, lon flipped if needed) -->
  <script id="data" type="application/json">{"type": "FeatureCollection", "features": []}</script>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
  <script>
    const map=L.map('map').setView([37.2,-77.9],9);
    const HEAT_PANE='heat-pane'; map.createPane(HEAT_PANE); map.getPane(HEAT_PANE).style.opacity='0.7';

    let basemapOn=true; const osm=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
    let showHeat=true; const r=document.getElementById('radius'); const o=document.getElementById('opacity');

    const proj=[]; let heat=null; const markers=L.layerGroup();
    function setHeatOpacity(v){const p=map.getPane(HEAT_PANE); if(p) p.style.opacity=String(Math.max(0,Math.min(1,parseFloat(v)||0)));}

    function rebuild(){
      if(heat) map.removeLayer(heat);
      heat=L.heatLayer(proj,{radius:parseInt(r.value,10)||20,blur:15,maxZoom:18,pane:HEAT_PANE});
      markers.clearLayers();
      proj.forEach(p=>markers.addLayer(L.circleMarker([p[0],p[1]],{radius:4,weight:1,color:'#0ea5e9',fillColor:'#0ea5e9',fillOpacity:0.8})));
      if(showHeat){map.addLayer(heat); map.removeLayer(markers);} else {map.removeLayer(heat); map.addLayer(markers);}
    }

    const gj=JSON.parse(document.getElementById('data').textContent);
    const b=L.latLngBounds();
    (gj.features||[]).forEach(f=>{ const c=f?.geometry?.coordinates; if(Array.isArray(c)&&c.length>=2){ const [lon,lat]=c; proj.push([lat,lon]); b.extend(L.latLng(lat,lon)); } });
    if(b.isValid()) map.fitBounds(b,{padding:[20,20]}); rebuild();

    document.getElementById('toggleLayer').addEventListener('click',()=>{showHeat=!showHeat; rebuild();});
    document.getElementById('toggleBasemap').addEventListener('click',e=>{basemapOn=!basemapOn; if(basemapOn){osm.addTo(map); e.target.textContent='Basemap: On';} else {map.removeLayer(osm); e.target.textContent='Basemap: Off';} });
    r.addEventListener('input',()=>{ if(heat&&heat.setOptions) heat.setOptions({radius:parseInt(r.value,10)||20}); else rebuild(); });
    o.addEventListener('input',()=>setHeatOpacity(o.value));
    setHeatOpacity(o.value);
  </script>
</body>
</html><!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Five Forks Fire Map — Inline Fixed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { height:100%; margin:0; padding:0; font-family: system-ui, Arial, sans-serif; }
    #toolbar { position:absolute; top:10px; left:10px; right:10px; z-index:1000; background:rgba(255,255,255,.95); padding:8px 12px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.12); display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    #map { width:100%; height:100%; }
    label { font-size:14px; }
    input[type=range] { width: 140px; }
    button { padding:6px 10px; border-radius:8px; border:1px solid #ddd; background:#f7f7f7; cursor:pointer; }
  </style>
</head>
<body>
  <div id="toolbar">
    <strong>Leaflet • Inline fixed</strong>
    <label>Radius <input id="radius" type="range" min="5" max="60" value="20"></label>
    <label>Opacity <input id="opacity" type="range" min="0.1" max="1" value="0.7" step="0.05"></label>
    <button id="toggleLayer">Toggle Heatmap / Pins</button>
    <button id="toggleBasemap">Basemap: On</button>
  </div>
  <div id="map"></div>

  <!-- Embedded, pre-repaired FeatureCollection (points-only, lon flipped if needed) -->
  <script id="data" type="application/json">{"type":"FeatureCollection","features":[]}</script>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
  <script>
    const map=L.map('map').setView([37.2,-77.9],9);
    const HEAT_PANE='heat-pane'; map.createPane(HEAT_PANE); map.getPane(HEAT_PANE).style.opacity='0.7';

    let basemapOn=true; const osm=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
    let showHeat=true; const r=document.getElementById('radius'); const o=document.getElementById('opacity');

    const proj=[]; let heat=null; const markers=L.layerGroup();
    function setHeatOpacity(v){const p=map.getPane(HEAT_PANE); if(p) p.style.opacity=String(Math.max(0,Math.min(1,parseFloat(v)||0)));}

    function rebuild(){
      if(heat) map.removeLayer(heat);
      heat=L.heatLayer(proj,{radius:parseInt(r.value,10)||20,blur:15,maxZoom:18,pane:HEAT_PANE});
      markers.clearLayers();
      proj.forEach(p=>markers.addLayer(L.circleMarker([p[0],p[1]],{radius:4,weight:1,color:'#0ea5e9',fillColor:'#0ea5e9',fillOpacity:0.8})));
      if(showHeat){map.addLayer(heat); map.removeLayer(markers);} else {map.removeLayer(heat); map.addLayer(markers);}
    }

    const gj=JSON.parse(document.getElementById('data').textContent);
    const b=L.latLngBounds();
    (gj.features||[]).forEach(f=>{
      const c=f?.geometry?.coordinates;
      if(Array.isArray(c)&&c.length>=2){const [lon,lat]=c; proj.push([lat,lon]); b.extend(L.latLng(lat,lon));}
    });
    if(b.isValid()) map.fitBounds(b,{padding:[20,20]}); rebuild();

    document.getElementById('toggleLayer').addEventListener('click',()=>{showHeat=!showHeat; rebuild();});
    document.getElementById('toggleBasemap').addEventListener('click',e=>{basemapOn=!basemapOn; if(basemapOn){osm.addTo(map); e.target.textContent='Basemap: On';} else {map.removeLayer(osm); e.target.textContent='Basemap: Off';}});
    r.addEventListener('input',()=>{ if(heat&&heat.setOptions) heat.setOptions({radius:parseInt(r.value,10)||20}); else rebuild(); });
    o.addEventListener('input',()=>setHeatOpacity(o.value));
    setHeatOpacity(o.value);
  </script>
</body>
</html>
